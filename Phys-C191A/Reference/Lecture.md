--- 第 1 页 ---

第 8 讲
私钥量子货币

讲师：Scott Aaronson

Scribe：Oded Regev

我们现在开始讨论状态和酉矩阵复杂性的最后一个应用——这个应用表面上看起来与量子引力相去甚远，尽管事实证明它们并非完全无关。

在 1960 年代末，远在任何人梦想量子计算之前，当时还是研究生的 Stephen Wiesner 写了一篇论文，提议使用量子物理学来制造不可伪造的货币。这篇论文被多次拒绝，直到 14 年后才发表在 SIGACT News 上 [Wie83]。

由于经典信息的可复制性，所有现有的电子现金方法都必须依赖受信任的第三方，如银行或信用卡机构，有时甚至依赖整个互联网（比如比特币的区块链）。为了解决这个问题，Wiesner 的基本思想是利用我们现在所说的“不可克隆定理”（来自第 1 讲），该定理指出无法复制一个未知的量子态。为什么我们不能利用这种现象来创造“量子钞票”呢？这种钞票可以被持有和交易，但在物理上却无法复制。

在实现量子货币时，显而易见的工程困难是，用户需要随身携带量子态（理想情况下，是在室温下放在钱包里），同时保持它们相干超过一小部分时间！主要就是这个问题迄今为止阻碍了量子货币的实际实现——与此相反，量子密钥分发（一个密切相关的想法，也源于 Wiesner 1969 年的论文）已经有了一些适度的商业部署。无论如何，从现在开始，我们将忽略实现问题，专注于量子货币的理论。

为简单起见，我们将始终假设量子货币只有一种面额。
在宏观层面上，量子货币需要满足两个要求：它需要是

(1) 不可克隆的（显然），而且还要是

(2) 可验证的——也就是说，用户应该能够验证呈现给他们的量子货币状态是有效状态，而不是一些垃圾。

8.1 Wiesner 和 BBBW 方案

Wiesner 的提议如下。每张量子钞票由两部分组成。第一部分是一个 n 比特的经典字符串 s，称为序列号，每张钞票独立且均匀地选择。就像今天的经典货币一样，序列号用于唯一地识别每张钞票。

70

--- 第 2 页 ---

第二部分是一个 n 量子比特的量子态，形式为

$|0\rangle|-\rangle|1\rangle|1\rangle|+\rangle\cdot\cdot\cdot|0\rangle$

这是从 $|0\rangle, |1\rangle, |+\rangle, |-\rangle$ 的所有 $4^{n}$ 种可能的 n 量子比特张量积中均匀选择的。制造钞票的银行存储一个配对 $(s,f(s))$ 的数据库，其中 $f(s)$ 是为钞票 s 生成的量子态 $|\psi_{s}\rangle$ 的经典描述（请注意 $f(s)$ 是 2n 比特长的）。

显然，如果用户将钞票 $(s,|\psi\rangle)$ 带回银行，银行可以验证钞票的真实性。
确实，银行只需在其数据库中检查 s是否是有效的序列号，如果是，则在适当的基 $\{|0\rangle,|1\rangle\}$ 或 $\{|+\rangle,|-\rangle\}$ 中测量 $|\psi_{s}\rangle$ 的每个量子比特，以确保它处于对应于 $f(s)$ 的状态。想要验证钞票的用户需要去银行（或通过量子通道将钞票发送给银行）。

那么伪造呢？假设伪造者得到一张合法的钞票 $(s,|\psi_{s}\rangle)$。
他能否用它制造出两张都能以高概率通过银行验证的钞票？

最朴素的策略是简单地（比如说）在标准基中测量每个量子比特，然后复制结果。该策略以 $(5/8)^{n}$ 的概率成功。（为什么？碰巧处于标准基的量子比特被成功复制；这以 $1/2$ 的概率发生。其余的量子比特被测量损坏，因此结果有 $1/4$ 的概率通过两次测量。）

一个不那么微不足道的策略是生成两个纠缠的钞票，使得两者都以 $(3/4)^{n}$ 的概率通过验证。这结果是紧的！为了回答 Aaronson 提出的一个问题，Molina、Vidick 和 Watrous [MVW99] 在 2012 年证明了这一点，Pastawski 等人 [PYJ+11] 也独立证明了这一点，他们使用了半正定规划来描述伪造者面临的问题。（出于某种原因，从 1969 年到 2012 年，人们一直满足于对 Wiesner 方案的含糊、定性的安全分析。）

严格来说，[MVW99, PYJ+11] 的结果并不构成完整的安全证明，因为（例如）它们没有考虑伪造者从多张合法钞票 $(s_{1},|\psi_{s_{1}}\rangle),...,(s_{m},|\psi_{s_{m}}\rangle)$ 开始的情况。然而，在最近未发表的工作中，Aaronson 给出了一个通用的安全归约，作为特例，它蕴含了 Wiesner 方案的完全安全性。

Wiesner 方案的明显缺点是需要将钞票带回银行才能验证。然而，即使我们撇开这一点不谈，第二个缺点是，为了验证，银行（及其所有分支机构）需要维护一个包含所有曾生产过的钞票的数据库。1982 年，Bennett、Brassard、Breidbart 和 Wiesner (BBBW) [BBBW82] 建议使用一种标准的密码学技巧来摆脱这个庞大的数据库。也就是说，他们提议用一个密码学伪随机函数替换随机函数 $f(s)$，或者更准确地说，用一个从伪随机函数族 (PRF) $\{f_{k}\}_{k}$ 中选择的函数 $f_{k}:\{0,1\}^{n}\longrightarrow\{0,1\}^{2n}$ 来替换。这样，银行只需存储一个秘密密钥 k。给定一张钞票 $(s,|f_{k}(s)\rangle)$，银行通过首先计算 $f_{k}(s)$，然后在适当的基中测量 $|f_{k}(s)\rangle$ 的每个量子比特来验证钞票，和以前一样。

直观地说，通过这样做，我们应该不会损害方案的安全性，因为伪随机函数无论如何都无法与真正的随机函数进行有效区分。
更正式地，我们论证如下：假设一个伪造者可以成功攻击 BBBW 方案。那么我们就可以区分伪随机函数 $f_{k}$ 和一个真正的随机函数，方法是使用给定的函数运行攻击，然后检查攻击是否成功
伪造。给定一个伪随机函数，根据假设，攻击应该成功，而
给定一个真正的随机函数，由于 Wiesner 原始方案的安全性，攻击不能成功。

71

--- 第 3 页 ---

8.2 形式化基础

为了使上述讨论更严谨，我们必须定义我们所说的量子货币到底是什么意思，
以及我们需要它满足哪些属性。Aaronson [Aar09] 在 2009 年完成了这项工作。

定义 8.2.1 ([Aar09])。一个私钥量子货币方案包括两个多项式时间
量子算法：

• $Bank(k)$ 生成对应于密钥 k 的钞票 $\$_{k}$。（ $\$_{k}$ 可以是一个混合态
对应于，例如，序列号的混合。）

• $Ver(k,\rho)$ 验证 $\rho$ 是密钥 k 的有效钞票。

如果由 $Bank(k)$ 生成的有效钞票 $\$_{k}$ 以至少 $1-\epsilon$ 的概率被 $Ver(k,\$_{k})$ 接受，我们说该方案具有完备性错误 $\epsilon$。如果对于所有多项式时间伪造者 C（输出某个数量 r 的寄存器）和所有
多项式 q，我们说该方案具有健全性错误 $\delta$，

$P[Count(k,C(\$_{k}^{q}))>q]<\delta$,

其中 Count 是在 C 输出的 r 个寄存器上分别运行 $Ver(k,\cdot)$ 并计数
它接受的次数的程序。（所以通俗地说，我们要求给定 q 张钞票，C 不能
生成超过 q 张钞票，除非概率为 $\delta$。）

我们还定义一个“迷你方案”(mini-scheme) 为如上所述的方案，但健全性限制为 $q=1$
和 $r=2$，即，流通中只有一张钞票，伪造者被要求产生两张
有效的钞票。

定理 8.2.2 (Aaronson 2013, 未发表)。我们可以构建一个具有可忽略的完备性和健全性错误的私钥量子货币方案，前提是给定

• 一个安全的迷你方案，以及

• 一个能抵抗量子攻击的伪随机函数族 (PRF) $\{f_k\}_k$。

证明概要。构造如下。给定一个生成量子
态 $\$_{k}$ 的迷你方案 M，我们定义一个货币方案 $M^{\prime}$，其钞票形式为

$\$_{k,s}^{\prime}:=|s\rangle\langle s|\otimes\$_{f_{k}(s)}$

其中 s 是均匀随机选择的。为了验证，银行应用 $Ver(f_{k}(s))$。

我们注意到，当我们将此构造应用于“迷你 Wiesner”方案（即没有序列号的 Wiesner 方案）时，我们得到了 BBBW 方案。要获得 Wiesner 的原始方案，
我们应该用一个真正的随机函数 f 替换 $f_{k}$。

完备性的证明很简单，而健全性（或安全性）使用了一个混合论证（hybrid argument）。
有趣的是，健全性的证明两次使用了 PRF 假设：首先，人们论证说攻破
$M^{\prime}$ 意味着要么对 PRF 进行了攻击（即，它可以与均匀函数区分开来），
要么对 $M^{\prime}$ 作为一个迷你方案进行了攻击；其次，人们论证说对 $M^{\prime}$ 作为一个迷你方案的攻击
意味着要么对 PRF 进行了攻击，要么对 M（作为一个迷你方案）进行了攻击。

$\Pi$

72

--- 第 4 页 ---

我们应该使用什么作为 PRF 族？
在密码学中，有许多基于各种密码学假设的 PRF 族构造。还有一个一般性的结果，
它说单向函数（在第 6 讲中定义的最基本的密码学原语，
没有它基本上就没有密码学）的存在已经足以推导出
PRF 的存在。这个推导分两步证明：

OWF $\xrightarrow{\text{HILL}}$ PRG $\xrightarrow{\text{GGM}}$ PRF,

第一步——OWFs 蕴含伪随机生成器 (PRGs)，将 n 个随机比特扩展为
$n^{O(1)}$ 个伪随机比特——归功于 Håstad 等人 [HILL99]。第二步——PRGs 蕴含
PRFs，将 n 个随机比特扩展为 $2^{n}$ 个伪随机比特——归功于 Goldreich、Goldwasser 和
Micali [GGM86]。这两步都是不平凡的，第一步尤其如此。

当然，在我们的情况下，我们需要一个能抵抗量子攻击的 PRF 族。幸运的是，
正如第 6 讲所讨论的，有许多已知的候选 OWFs，据任何人所知，它们都是
量子安全的。而且，人们可以通过修改 HILL 和 GGM 的论证来表明，
量子安全的 PRFs 可以从量子安全的 OWFs 推导出来。第一步，HILL 的那一步，
同样适用于量子设置。然而，GGM 的那一步在量子设置中失效了，因为它
关键性地使用了“攻击者查询的所有输入的集合”，以及这个集合的大小
最多是多项式级别的这一事实——当攻击者可以叠加查询所有 $2^{n}$ 个
输入位置时，这不再成立。不过幸运的是，在 2012 年，Zhandry [Zha12] 找到了
GGM 安全归约的另一种证明，它确实适用于量子攻击者。¹

8.3 安全性/存储权衡

总而言之，我们已经看到 Wiesner 的方案是无条件安全的，但需要一个巨大的
数据库，并且它可以如上所述转换为 BBBW 方案，该方案只是计算上
安全的，但不需要巨大的数据库。我们还提到，BBBW 方案中所需的量子安全
PRF，已知可以从量子安全 OWF 推导出来。

鉴于上面的讨论，人们可能想知道是否存在 (1) 信息论上安全，
并且 (2) 不需要大量存储的量子货币方案。事实证明，这样的
方案是不可能的。

定理 8.3.1 (Aaronson 2013, 未发表)。任何银行只存储 n 比特的方案
都可以被指数时间量子伪造者攻破，仅使用 poly(n) 个合法的货币
状态和对银行的 $O(n)$ 次验证查询。（或者，我们可以避免验证查询，
而是得到一个以 $\Omega(1/n)$ 概率通过验证的输出。）

证明。我们用 $k^{*}\in\{0,1\}^{n}$ 来表示银行存储的实际秘密。“我们”（即
伪造者）被给予状态 $\$_{k^{*}}^{\otimes m}$，其中 $m=n^{O(1)}$，我们需要以不可忽略的
概率产生 $m+1$ 个或更多都能通过验证的量子货币状态。

一个朴素的策略是蛮力搜索密钥 $k^{*}$，但这出于显而易见的原因行不通。
也就是说，我们手头只有 poly(n) 张合法钞票（而且银行也没那么
天真，如果我们的钞票未通过验证，它还会发给我们一张全新的钞票！）。而且我们只能向银行进行 poly(n) 次
查询。

¹ 另一方面，对于量子货币的应用，可以假设对伪随机函数 $f_{k}$ 进行经典查询，因为攻击者拥有的钞票集合是一个确定的、经典的集合，因此人们
并不严格需要 Zhandry 结果的威力。

73

--- 第 5 页 ---

因此，我们将转而在“潜在候选秘密 S”的集合上进行递归，关键的
陈述将是，在任何给定的迭代中，S 至少缩小一个常数因子。

预警：我们不保证能找到 $k^{*}$ 的实际值（例如，如果 $\$_{k^{*}}=\$_{k^{\prime}}$ 对于某个
其他 $k^{\prime}$，我们永远无法区分这两者）。我们只声称我们可以得出一个
“活字”(linotype) $S\ni k^{*}$，它对于伪造目的来说已经足够好了。

最初，我们对 $k^{*}$ 没有任何了解，所以我们简单地设置 $S:=\{0,1\}^{n}$。
现在让 S 是我们当前的猜测。我们生成（不奇怪地）对应钞票上的均匀混合：

$\sigma_{S}=\frac{1}{|S|}\sum_{k\in S}|\$_{k}\rangle\langle\$_{k}|$

并将其提交给银行。

如果 $\sigma_{S}$ 被接受，那么 S 就是我们的活字；我们可以用它来印制新钞票。

更有趣的情况是 $Ver(k^{*},\sigma_{S})$ 以高概率拒绝。然后，拥有
无限的计算能力，我们可以为自己构建集合 $U\ni k^{*}$，其中包含所有那些 $k$，
使得 $Ver(k,\sigma_{S})$ 以高概率拒绝。接下来，我们使用 poly(n) 个合法状态
$\$_{k}$ 的副本（我们稍后会解释如何做到这一点）来找到某个密钥 $k^{\prime}\in U$，使得 $Ver(k^{\prime},\mathbb{S}_{k^{*}})$ 以
高概率接受。最后，我们使用这个密钥 $k^{\prime}$ 来遍历混合 $\sigma_{S}$ 中的所有单个状态 $\$_{k}$，
并剔除所有那些 $k$，使得 $Ver(k^{\prime},\$_{k})$ 以高概率拒绝。请注意，$k^{*}$ 存活
下来了（这是我们需要保持的唯一属性）。同时，S 中至少有一个常数
比例的条目被移除，这是根据定义和马尔可夫不等式的简单
应用得出的。

所以剩下的就是解释如何只使用 poly(n) 张合法钞票来找到 $k^{\prime}$。

为此，我们使用了另外两个想法：错误放大（error amplification）和“几乎完好如初引理”
（Almost As Good As New Lemma）（第 1 讲的引理 1.3.1）。使用错误放大和 poly(n) 个合法钞票的副本，
我们可以不失一般性地假设：

• $Ver(k^{*},\$_{k^{*}})$ 以压倒性概率 $1-exp(-Cn)$ 接受，而

• 对于任何“坏”密钥 k（定义为原始接受概率小于
0.8 的密钥），$Ver(k,\$_{k^{*}})$ 以指数级小的概率 $exp(-Cn)$ 接受。

现在考虑对 U 进行蛮力搜索，比如说按字典序，同时使用
“几乎完好如初引理”来修复我们的状态 $\$_{k}$。那么希望是，当我们的状态
到达 $k^{*}$ 时，它仍然处于可用状态——我们在此过程中遇到的任何“坏”密钥 k
最多只会对状态造成指数级小的损害。

不幸的是，上述方法并不完全有效；还有一个技术问题我们需
要处理。即：如果在搜索 U 时，我们遇到了“仅仅是相当好，但
不是极好”的密钥怎么办？在这种情况下，危险在于应用 $Ver(k,\cdot)$ 会严重损害状态，
但仍不会导致我们接受 k。

人们可能希望通过调整“好”和“坏”密钥的定义来解决这个问题：毕竟，如果
k 足够好，以至于它导致即使是放大过的验证者也有不可忽略的接受概率，
那么想必原始的、未放大的接受概率至少是（比如）0.7，
如果不是 0.8 的话。问题是，无论我们如何设置阈值，都可能存在恰好处于
边界上的密钥，其接受概率高到足以损害我们的状态，但又不足以
让我们可靠地接受它们。

为了解决这个问题，我们使用以下引理，该引理建立在 Aaronson [Aar06] 的工作之上，
并由 Harrow 和 Montanaro [HM16] 做了重要修正。
$\Pi$

74

--- 第 6 页 ---

引理 8.3.2 (“秘密接受者引理”)。令 $M_{1},...,M_{N}$ 是已知的 2-结果 POVMs，令
$\rho$ 是一个未知状态。假设我们被承诺存在一个 $i^{*}\in[N]$ 使得

$P[M_{i^{*}} (\rho) \text{ 接受}] \ge p$。

那么给定 $\rho^{\otimes r}$，其中 $r=O(\frac{log^{4}N}{\epsilon^{2}})$，存在一个测量策略来找到一个 $i\in[N]$ 使得

$P[M_{i}(\rho) \text{ 接受}] \ge p-\epsilon$，

其成功概率至少为 $1-\frac{1}{N}$。

证明概要。关键要素是一个称为“量子或界限”(Quantum OR Bound) 的结果，它陈述
如下：

• 令 $M_{1},...,M_{N}$ 是已知的 2-结果 POVMs，令 $\rho$ 是一个未知状态。那么给定
$\rho^{\otimes r}$ 其中 $r=O(log~N)$，存在一个测量策略，如果存在一个 i 使得 $P[M_{i}(\rho) \text{ 接受}] \ge 2/3$，则以压倒性
概率接受，如果对于所有 i，$P[M_{i}(\rho) \text{ 接受}] \le 1/3$，则以
压倒性概率拒绝。

要证明量子或界限，显而易见的方法是，对于每个 i，依次
将 $M_{i}$ 的放大版本应用于 $\rho^{\otimes r}$。问题在于可能存在一些 i，使得放大的
测量接受的概率既不非常接近 0 也不非常接近 1——在这种
情况下，测量可能会损害状态（危及未来的测量），
但又不会导致压倒性的接受概率。直观地说，解决方案
应该涉及论证，如果发生这种情况，那么无论如何我们都有 $P[M_{i}(\rho) \text{ 接受}] > 1/3$，因此
接受是安全的。或者换句话说：如果我们在第 $i$ 次测量时接受，那么要么 $M_{i}(\rho)$
以高概率接受，要么我们的状态被先前的测量损坏了——但在
后一种情况下，那些先前的测量中的某一些（我们不知道是哪些）必定已经以
一个足够高的概率接受了 $\rho$。

问题在于，如果 $M_{1},...,M_{N}$ 是以一种恶意的方式选择的，那么按顺序应用它们
可能会慢慢地将状态“拖”得远离初始状态 $\rho^{\otimes r}$，而没有任何 $M_{i}$
以高概率接受（即使稍后的测量会接受 $\rho^{\otimes r}$ 本身）。
2006 年，Aaronson [Aar06] 在证明 $QMA/qpoly\subseteq PSPACE/poly$（我们在第 5 讲中将其称为定理 5.6.6）的背景下遇到了这个问题。在 [Aar06] 中，
Aaronson 声称可以通过简单地以随机顺序选择 $M_{i}$ 来规避这个问题，
而不是以预定的（并可能是对抗性的）顺序 $M_{1},...,M_{N}$。

不幸的是，最近 Harrow 和 Montanaro [HM16] 在 Aaronson 对
这一说法的证明中发现了一个错误。正如他们指出的，Aaronson 的随机测量策略
似乎仍然是合理的——但如果是这样，那么就需要一个新的证明（Harrow 和 Montanaro 将其作为一个
迷人的开放问题）。

不过，与此同时，Harrow 和 Montanaro 通过
给出一种不同的测量策略，并成功证明了其健全性，从而恢复了量子或界限本身。我们建议
读者参考他们的论文以获取详细信息，但基本上，他们的策略是通过首先将一个控制量子比特置于
$|+\rangle$ 状态，然后以控制量子比特为 $|1\rangle$ 为条件，将放大的测量应用于 $\rho^{\otimes r}$，
并周期性地在 $\{|+\rangle,|-\rangle\}$ 基中测量控制量子比特，以检查
测量是否对状态造成了很大损害。如果某个测量接受了，或者
状态被发现已损坏，我们就接受。

75

--- 第 7 页 ---

现在，一旦我们有了量子或界限，引理 8.3.2 的证明就可以通过
二分搜索的简单应用得出（尽管这将 $\rho$ 所需的副本数量进一步
增加了 polylog(N) 因子）。更准确地说：为简单起见，假设 N 是 2 的幂。那么我们首先
将量子或界限（具有适当选择的概率截止值）应用于测量集合
$M_{1},...,M_{N/2}$。然后我们将或界限分别（即，使用 $\rho$ 的新副本）应用于集合
$M_{N/2+1},...,M_{N}$。以压倒性的概率，这些应用中至少有一个会接受，
在这种情况下，我们得知 $M_{i}$ 的一个子集（包含一半的 $M_{i}$）包含一个以
高概率接受 $\rho$ 的测量——不失一般性，假设它是 $M_{1},...,M_{N/2}$。然后我们递归，将
$M_{1},...,M_{N/2}$ 分成两个大小为 $N/4$ 的子集，依此类推，进行 log N 次迭代，直到我们分离出一个 $i^{*}$
使得 $M_{i^{*}}$ 以高概率接受。在每次迭代中，我们都使用 $\rho$ 的新副本。

只剩下一个技术问题：即，在每次迭代开始时，我们都有一个
承诺，即我们正在搜索的区域包含一个测量 $M_{i}$，它以至少 p 的概率接受。
然后我们归约到一个更小的区域，该区域包含一个以至少 $p-\delta$ 的概率
接受 $\rho$ 的测量，其中 $\delta>0$ 是某个容差因子。因此，如果 $\delta$ 是常数，那么我们只能继续
常数次迭代。解决方案是简单地设置 $\delta:=\frac{\epsilon}{log~N}$，其中 $\epsilon$ 是
引理陈述中的最终误差界限。这会使 $\rho$ 所需的副本数量激增——但（可以
核查）只会增加到

$O(\frac{log^{4}N}{\epsilon^{2}})$。

8.3.1 开放问题

像往常一样，我们现在可以问：是否存在任何复杂性类别的坍缩，例如 P = PSPACE，
使得定理 8.3.1 的伪造算法在计算上是高效的，而
不仅仅是在合法钞票和银行查询的数量上高效？我们已经看到，如果
量子安全的 OWFs 存在，那么该算法就不可能是高效的——但就像
防火墙和 HH 解码任务的情况一样，我们没有该结果的逆命题，
即表明如果伪造是困难的，那么某些“标准”密码学假设必定会失败。

同时，引理 8.3.2 的证明提出了一个关于量子态层析成像的迷人的开放问题，
我们忍不住要简短地离题讨论一下。

令 $\rho$ 是一个未知状态，令 $E_{1},...,E_{N}$ 是一些已知的二结果 POVMs 列表。
假设我们不仅想找到一个 $i^{*}$ 使得 $Tr(E_{i^{*}}\cdot\rho)$ 很大，而是想估计所有 $Tr(E_{i}\rho)$
到某个加性误差 $\epsilon>0$ 以内，成功概率至少为（比如）0.99。
这需要什么资源？

当然，如果我们有 $O(N~log~N)$ 个 $\rho$ 的新副本，这个任务是微不足道的：在这种情况下，我们只需将
每个 $E_{i}$ 应用于它自己的 log N 个副本。

但假设我们只被给予了 $\rho$ 的 polylog N 个副本。即使在这种情况下，也不难
看出，当 $Tr(E_{i}\rho)$ 被承诺远离 $1/2$ 时（例如，
对于所有 i，要么 $Tr(E_{i}\rho)>2/3$ 要么 $Tr(E_{i}\rho)<1/3$），该任务是可以实现的。因为那样的话我们可以简单地
相继应用放大的 $E_{i}$，并使用“几乎完好如初引理”来将
$\rho^{polylog~N}$ 的损害上限定为 $o(1)$。

我们现在提出以下开放问题：

76

--- 第 8 页 ---

问题 8.3.3 (“批量层析成像问题”)。在没有关于概率的承诺的情况下，
仅用 $\rho$ 的 polylog N 个副本是否可以实现上述估计任务？

请注意，这个问题没有指定任何对希尔伯特空间维度 d 的依赖，因为
可以想象存在一个完全没有维度依赖的测量过程
（例如，就像量子或界限和引理 8.3.2 那样）。但是一个非平凡的
维度相关的结果（即，一个不仅仅依赖于 $\rho$ 的完整层析成像的结果）也会
很有意义。

8.4 交互式攻击

回到量子货币，我们已经看到 Wiesner 式和 BBBW 式的私钥量子货币方案之间存在固有的权衡。然而，无论我们选择哪一种，都存在一个紧随其后的问题。也就是说，伪造者或许能够利用对
银行的重复查询——即所谓的交互式攻击——来了解钞票的量子态。

事实上，这可以被视为我们最初对私钥量子
货币的定义中的一个安全漏洞。也就是说，我们从未明确说明在客户（或者，我们不妨假设，
一个伪造者）提交钞票进行验证后会发生什么。如果钞票被接受，伪造者是拿回受损的（即
测量后的）钞票，还是银行会发行一张全新的钞票？如果
钞票未通过验证会怎样？这里的可能性从银行极其天真，
即使在这种情况下也把钞票还给客户，到极其严格，立即
报警。正如我们将在第 9 讲中看到的，我们可以得到即使银行
最天真、会退还钞票，也仍能被证明是安全的方案，但证明这一点需要下功夫。

至于最初的 Wiesner 和 BBBW 方案，事实证明它们都可以被
交互式攻击完全攻破。要看到这一点，让我们首先考虑“天真银行”的情景：
即使钞票未通过验证，银行也会退还钞票。在这种情况下，Aaronson [Aar09] 和 Lutomirski [Lut10] 独立地观察到了一个对 Wiesner 方案的简单攻击。

攻击的工作原理如下：伪造者从一张合法的钞票开始，

$|\$\rangle=|\theta_{1}\rangle|\theta_{2}\rangle\cdot\cdot\cdot|\theta_{n}\rangle$

伪造者随后重复将这张钞票提交给银行进行验证，依次
将第一个量子比特 $|\theta_{1}\rangle$ 换成 $|0\rangle, |1\rangle, |+\rangle, |-\rangle$。通过观察 $|\theta_{1}\rangle$ 的哪种选择
导致银行接受，经过 $O(log~n)$ 次重复，伪造者就知道 $|\theta_{1}\rangle$ 的正确值，
出错的概率仅为（比如） $1/n^{2}$。此外，由于银行对 $|\theta_{2}\rangle,...,|\theta_{n}\rangle$ 的测量
是在正确的基上进行的，这些量子比特在验证过程中根本没有受损。接下来
伪造者重复提交 $|\$\rangle$ 给银行，使用现在已知的 $|\theta_{1}\rangle$ 的正确值，但是
依次用 $|0\rangle, |1\rangle, |+\rangle, |-\rangle$ 替换 $|\theta_{2}\rangle$，依此类推，直到所有 n 个量子比特都被学到。

8.4.1 Elitzur-Vaidman 炸弹攻击

当然，如果银行采取了简单的反制措施，
即一旦有钞票未通过验证就报警（或者，也许，一旦有太多具有相同序列号的坏钞票被
提交），那么上述伪造策略就会失败！

然而，在 2014 年，Nagaj 和 Sattath [NS14] 巧妙地改进了对 Wiesner 方案的攻击，
使其即使在银行会在单次验证失败后报警的情况下也能奏效。他们的构造

77

--- 第 9 页 ---

是基于 Elitzur-Vaidman 炸弹 [EV93] 的，这是一种与 Grover 算法相关
但极其反直觉且本身非常有趣的量子效应——所以让我们现在
离题讨论一下 Elitzur-Vaidman 炸弹。

假设某人有一个包裹 P，它可能是也可能不是一颗炸弹。你可以给
这个人发送一个比特 $b\in\{0,1\}$。你总能拿回这个比特。但是如果你发送 $b=1$（“我相信
你的包裹里有炸弹”）并且 P 是一个炸弹，那么它就会爆炸，杀死所有人。任务是
在不实际引爆炸弹的情况下，了解 P 是否是炸弹。

这在经典上显然是不可能的。因为获取关于 P 的任何信息的唯一方法
是最终敢于提出 $b=1$ 的问题，并承担其所有后果。

量子情况则不然！我们可以将包裹 P 建模为一个未知的 1-量子比特算符，作用于
你发送的一个量子比特 $|b\rangle$。如果没有炸弹，那么 P 只是作为恒等算符作用于 $|b\rangle$。如果有炸弹，
那么 P 在 $\{|0\rangle, |1\rangle\}$ 基中测量 $|b\rangle$。如果 P 观察到 $|0\rangle$，那么它将量子比特返回给你，而
如果 P 观察到 $|1\rangle$，那么它就会引爆炸弹。

现在令

$R_{\epsilon}=(\begin{smallmatrix}cos~\epsilon&-sin~\epsilon\\ sin~\epsilon&cos~\epsilon\end{smallmatrix})$

是一个将 $|b\rangle$ 旋转一个小角度 $\epsilon>0$ 的酉矩阵。

那么你只需使用以下算法：

• 初始化 $|b\rangle:=|0\rangle$

• 重复 $\frac{\pi}{2\epsilon}$ 次：

• 将 $R_{\epsilon}$ 应用于 $|b\rangle$

• 将 $|b\rangle$ 发送给 P

• 在 $\{|0\rangle, |1\rangle\}$ 基中测量 $|b\rangle$

• 如果结果是 $|0\rangle$ 则输出“有炸弹”；如果结果是 $|1\rangle$ 则输出“无炸弹”

让我们分析一下这个算法。如果没有炸弹，那么对 P 的调用什么也不做，所以 $|b\rangle$
只是被 $R_{\epsilon}$ 旋转了 $\frac{\pi}{2\epsilon}$ 次，从 $|0\rangle$ 演化到 $|1\rangle$。另一方面，如果
有炸弹，那么你重复提交 $|b\rangle=cos~\epsilon|0\rangle+sin~\epsilon|1\rangle$ 给 P，于是 P 在
标准基中测量 $|b\rangle$，以 $sin^{2}\epsilon\approx\epsilon^{2}$ 的概率观察到 $|1\rangle$（并因此引爆炸弹）。
因此，在所有 $\frac{\pi}{2\epsilon}$ 次调用中，炸弹被引爆的总概率为 $\epsilon^{2}/\epsilon=\epsilon$ 量级，
通过选择足够小的 $\epsilon$，这当然可以变得任意小。此外，假设
炸弹没有被引爆，量子比特 $|b\rangle$ 最终处于状态 $|0\rangle$，因此测量 $|b\rangle$ 会
（非破坏性地！）揭示炸弹的存在。当然，使该算法奏效的是
量子测量能够将 $\epsilon$ 的幅度转换为 $\epsilon^{2}$ 的概率。

Nagaj 和 Sattath [NS14] 意识到，即使在银行起疑的情况下，也可以使用类似的效果
来攻击 Wiesner 的方案。回想一下 Aaronson [Aar09] 和 Lutomirski [Lut10] 的攻击，
它一次学习 Wiesner 钞票的一个量子比特 $|\theta_{i}\rangle$。我们希望改进这种攻击，使得
伪造者仍然能以高概率学到 $|\theta_{i}\rangle$，而无需提交任何
未通过验证的钞票。特别是，这意味着：提交的钞票的第 $i$ 个量子比特
与 $|\theta_{i}\rangle$ 本身的偏离不超过某个很小的 $\epsilon$。（就像在早先的攻击中一样，我们可以假设
当我们在尝试学习 $|\theta_{i}\rangle$ 的经典描述而改变它时，
对于 $j\ne i$ 的量子比特 $|\theta_{j}\rangle$ 都处于正确的状态。）

78

--- 第 10 页 ---

Nagaj 等人的过程，和之前的过程一样，是逐个量子比特进行的：这是可以的，
因为如果我们的钞票通过了验证，我们会拿回它，而如果我们失败了，我们有比学习剩余量子比特更紧迫的问题
要担心。所以让我们假设 $n=1$：也就是说，我们想要学习
一个量子比特 $|\theta\rangle\in\{|0\rangle,|1\rangle,|+\rangle,|-\rangle\}$。

算法如下：我们（伪造者）准备一个处于 $|0\rangle$ 状态的控制量子比特。
然后我们重复以下操作 $\frac{\pi}{2\epsilon}$ 次：

• 应用一个 1-量子比特酉矩阵，将控制量子比特逆时针旋转 $\epsilon$。

• 从控制量子比特到货币量子比特（$|\theta\rangle$）应用一个 CNOT 门。

• 将货币量子比特发送给银行进行测量。

要了解为什么这个算法有效，需要考虑四种情况：

• 如果 $|\theta\rangle=|+\rangle$，那么对 $|+\rangle$ 应用 CNOT 不起作用。所以控制量子比特只是
旋转 $\epsilon$ 角度 $\frac{\pi}{2\epsilon}$ 次，从 $|0\rangle$ 变为 $|1\rangle$。在任何情况下，银行的测量都不会产生
结果 $|-\rangle$。

• 如果 $|\theta\rangle=|0\rangle$，那么对 $|0\rangle$ 应用 CNOT 会产生状态

$cos(\epsilon)|00\rangle+sin(\epsilon)|11\rangle$

银行的测量随后以 $cos^{2}(\epsilon)\approx1-\epsilon^{2}$ 的概率产生结果 $|0\rangle$。
假设观察到 $|0\rangle$，状态坍缩回 $|00\rangle$，循环重复。通过
并集界限（union bound），银行观察到结果 $|1\rangle$ 的概率最多为

$\frac{\pi}{2\epsilon}sin^{2}(\epsilon)=O(\epsilon)$。

• 如果 $|\theta\rangle=|1\rangle$，情况与 $|\theta\rangle=|0\rangle$ 的情况完全类似。

• 如果 $|\theta\rangle=|-\rangle$，那么对 $|-\rangle$ 应用 CNOT 会产生状态

$(cos(\epsilon)|0\rangle-sin(\epsilon)|1\rangle)\otimes|-\rangle$。

所以在下一次迭代中，控制量子比特被旋转回 $|0\rangle$（没有发生任何事情）；
然后它被旋转回 $cos(\epsilon)|0\rangle-sin(\epsilon)|1\rangle$，依此类推，在这两个状态之间循环。
在任何情况下，银行的测量都不会产生结果 $|+\rangle$。

总结一下，如果 $|\theta\rangle=|+\rangle$，那么控制量子比特被旋转到 $|1\rangle$，而如果 $|\theta\rangle$ 是
其他三种可能性中的任何一种，那么控制量子比特以
压倒性的概率保持在 $|0\rangle$ 状态（或接近 $|0\rangle$）。所以在最后，在 $\{|0\rangle, |1\rangle\}$ 基中测量控制量子比特让我们
可以区分 $|\theta\rangle=|+\rangle$ 和其他三种情况。通过对称性，我们可以
为其他三种状态重复类似的过程，从而（使用 $O(1/\epsilon)$ 次试验验证）学到 $|\theta\rangle$，
被抓住的概率最多为 $O(\epsilon)$。因此，通过对每个 $\theta_{i}$ 重复该算法，我们用 $O(n/\epsilon)$ 次试验验证
学到整个钞票，被抓住的概率最多为 $O(n\epsilon)$。

虽然我们是针对 Wiesner 方案解释了这些攻击，但同样的攻击稍作修改
也适用于 BBBW 方案——实际上，适用于任何钞票由
未纠缠的量子比特组成，并且通过分别对每个量子比特进行投影测量来验证钞票的方案。

79

--- 第 11 页 ---

然而，在解释了这些攻击之后，我们也应该提到一个极其简单的修复方法
。这个修复方法就是，银行在验证后不再将钞票退还给客户，而是
销毁钞票，并返还一张相同面额的新钞票（带有新序列号）！
如果这样做了，那么我们最初为私钥量子货币给出的安全定义
就确实有意义了。

8.5 量子货币和黑洞

我们在本讲结束时给出以下观察。正如我们上面所看到的，量子安全的 OWFs
足以获得一个带有小密钥的私钥量子货币方案。可以证明，如果
OWFs 还是单射的，它们会给我们额外的东西：即一个“单射”的私钥
量子货币方案，其中不同的序列号 $k\ne k^{\prime}$ 映射到近乎正交的
钞票，$|\langle\$_{k}|\$_{k^{\prime}}\rangle|<\epsilon$。现在，我们在第 6 讲中看到，单射的、量子安全的 OWFs 也
足以推断 HH 解码任务是困难的。

但是，私钥量子货币和 HH 解码任务之间是否存在任何
不通过 OWFs 介导的直接关系？事实证明是有的。要看到这一点，在 Aaronson 对 HH 解码任务的第一个难度结果（即定理 6.5.3 中的第一个构造）中，我们只需
将单射 OWF 输出 $|f(x)\rangle$ 替换为单射私钥量子
货币方案的输出 $|\$_{k}\rangle$，得到状态

$|\psi\rangle_{RBH}=\frac{1}{\sqrt{2^{n+1}}}\sum_{k\in\{0,1\}^{n}}(|k~0^{p(n)-n},0\rangle_{R}|0\rangle_{B}+|\$_{k},1\rangle_{R}|1\rangle)|k\rangle_{H})$ 。

然后，与定理 6.5.3 证明中相同的论证表明，解码
此状态下 R 和 B 之间纠缠的能力将意味着从 $|\$_{k}\rangle$ 传递到 $|k\rangle$ 的能力——并且
因此，有能力攻破私钥量子货币方案。所以我们得到以下
推论，这也许比任何其他
单一陈述更能体现本课程中各种奇怪的联系：

定理 8.5.1。假设存在一个安全的、私钥的、单射的量子货币方案
且密钥很小。那么 HH 解码任务是困难的。

（或者换句话说：“解码黑洞霍金辐射的能力意味着
伪造量子货币的能力。”）

由于单射 OWFs 蕴含了具有小密钥的单射私钥量子货币，但
反之未知，因此定理 8.5.1 比定理 6.5.3 更强，因为它将
HH 解码的难度建立在了一个更弱的假设之上。

80

--- 第 12 页 ---

第 9 讲

公钥量子货币

讲师：Scott Aaronson

Scribe：Alexander Razborov

正如上一讲所明确的，一个有趣的问题是，是否存在任何私钥量子
货币方案，使得钞票在验证后可以返回给客户，但
仍然能抵抗交互式攻击。我们将在本讲后面回到这个问题。

但只要我们还在探索，我们不妨更有雄心壮志，
去追求 Aaronson [Aar09] 所称的公钥量子货币方案。与公钥密码学类比，
这是一种量子货币方案，其中绝对任何人都可以验证钞票，而不仅仅是
印制它的银行——也就是说，验证钞票根本不再需要把它带到银行。并且
尽管公开了验证程序，银行仍然以某种方式确保没有人
能利用该程序来有效地复制钞票。

遵循 Aaronson [Aar09] 以及 Aaronson 和 Christiano [AC12] 的工作，我们现在以定义 8.2.1 的风格，
给出一个更精确的公钥量子货币的定义。

定义 9.0.2。一个公钥量子货币方案包括三个多项式时间算法：

• $KeyGen(0^{n})$，它输出一对 $k=(k_{pub},k_{private})$（这当然是概率性的）；

• $Bank(k)=\$_{k}$（与定义 8.2.1 完全相同）；

• $Ver(k_{pub},\rho)$（与定义 8.2.1 相同，只是现在验证者只能访问
密钥的公共部分）。

完备性和健全性错误的定义与之前完全相同，只是在
适当的地方用 $k_{pub}$ 替换了 k。完备性是在最坏情况（相对于 k 的选择）下定义的，
而在定义健全性时，我们对 KeyGen 的内部随机性取平均。

9.1 公钥迷你方案

就像我们有私钥迷你方案的概念一样，我们也有相应的公钥
迷你方案的概念。

定义 9.1.1。一个公钥迷你方案包括两个多项式时间算法：

• $Bank(0^{n})$，它概率性地输出一对 $\$=(s,\rho_{s})$（其中 s 是一个经典序列号）；

• $Ver(\$)$，它接受或拒绝一张声称的钞票。

81

--- 第 13 页 ---

如果

$P[Ver(\$) \text{ 接受}] \ge 1-\epsilon$，

则该方案具有完备性错误 $\epsilon$。
如果对于所有将 $\$=(s,\rho_{s})$ 映射为两个
可能纠缠的状态 $\sigma_{1}$ 和 $\sigma_{2}$ 的多项式时间伪造者，我们有

$P[Ver(s,\sigma_{1}), Ver(s,\sigma_{2}) \text{ 都接受}] < \delta$，

则该方案具有健全性错误 $\delta$。

就像在私钥情况下一样，要从一个迷你方案变为一个完整的货币方案，需要一个
额外的要素。在这种情况下，这个要素原来是一个能抵抗量子攻击的传统数字签名
方案。我们不会给出严格的定义，但粗略地说：数字
签名方案是一种使用私钥 $k_{private}$ 签署消息的方式，使得

• 签名可以使用公钥 $k_{public}$ 被高效地验证，并且

• 只知道 $k_{public}$ 而不知道 $k_{private}$ 的代理人不能有效地生成任何尚未见过的消息
及其该消息的有效签名，即使在看过了
他们选择的任意多项式数量的消息的有效签名之后。

现在，给定一个公钥迷你方案外加一个量子安全的签名方案，
Lutomirski 等人在 2010 年 $[\text{LAF}^{+}10]$ 首次提出了
产生一个完整公钥货币方案的构造，
其安全性分析由 Aaronson 和 Christiano 在 2012 年 [AC12] 给出。

这个想法很简单，就是把一个迷你方案的钞票 $(s,\rho_{s})$，通过
数字签名序列号 s，然后把签名附加为
序列号的额外部分，来把它变成一个完整的货币方案钞票：

$\$_{k}=(s,sign(k,s),\rho_{s})$。

要检查由此产生的钞票，首先要检查数字签名 $sign(k,s)$，以确保
钞票 $\$_{k}$ 确实来自银行而不是冒名顶替者。然后使用
底层迷你方案的验证程序检查 $(s,\rho_{s})$。直观地说，那么，要印制更多货币，
伪造者要么需要产生带有新序列号和新签名的新钞票，从而
攻破签名方案，要么产生带有已见过序列号的新钞票，从而
攻破迷你方案。这个直觉可以被严谨化：

定理 9.1.2 (Aaronson-Christiano [AC12])。如果存在针对上述公钥
量子货币方案的伪造者，那么也存在针对迷你方案
或签名方案的伪造者。

定理 9.1.2 的证明是一个相对标准的密码学混合论证，
因此在此省略。

现在，我们有许多量子安全签名方案的优秀候选者（实际上，
Rompel [Rom90] 的一个结果表明，这类方案可以从任何量子安全的
单向函数构造出来）。因此，公钥量子货币的问题可以归结为
构造一个安全的公钥迷你方案的问题。

82

--- 第 14 页 ---

9.2 候选方案

我们该怎么做呢？在过去的十年里，人们提出了许多具体的迷你方案，但是唉，
它们中的大多数后来都被攻破了，而那些剩下的方案似乎极难分析。
举三个例子：

• Aaronson [Aar09] 在 2009 年提出了一个基于稳定态 (stabilizer states) 的方案。这个方案
随后被 Lutomirski 等人 $[\text{LAF}^{+}10]$ 攻破，他们使用了一个非平凡的算法来寻找
随机图中的隐藏团 (planted cliques)。

• 有几个方案基于 QMA-完备的局部哈密顿量问题（见第 4 讲）的随机实例
。所有这些方案随后在 2010 年被 Farhi 等人 $[\text{FGH}^{+}10]$ 攻破，
他们使用了一种他们称之为单拷贝层析成像 (single-copy tomography) 的新技术。我们稍后会
更多地讨论单拷贝层析成像。

• 2012 年，Farhi 等人 $[\text{FGH}^{+}12]$ 提出了另一种基于纽结理论 (knot theory) 的方法。在这种
方法中，一张量子钞票是共享某个
Alexander 多项式（一种可有效计算的纽结不变量）给定值 v 的有向环图 (oriented link diagrams) 的叠加态，
序列号编码 v。截至 2016 年，该方案仍未被攻破，但
仍不清楚如何评论其安全性（例如，通过给出一个归约）。

9.3 相对于预言机的公钥量子货币

鉴于构造一个安全的公钥迷你方案显然很困难，也许我们应该
从一个更简单的问题开始：是否存在一个预言机 A，使得如果银行、客户和
伪造者都可以访问 A，那么公钥量子货币是可能的？如果（正如我们所希望的）
答案是肯定的，那么我们就可以着手用一个显式函数替换 A。

2009 年，Aaronson [Aar09] 表明，至少存在一个量子预言机（如第 5 讲
所定义的），相对于它，公钥量子货币是可能的。

定理 9.3.1 (Aaronson 2009 [Aar09])。存在一个量子预言机 U，相对于它
公钥迷你方案存在。

证明概要。我们首先固定一个从 n 比特序列号 s 到 n 量子比特纯态 $|\psi_{s}\rangle$ 的
映射，其中每个 $|\psi_{s}\rangle$ 是从哈尔测度 (Haar measure) 中独立选择的。那么每张有效的钞票都将
具有 $(s,|\psi_{s}\rangle)$ 的形式，并且验证一张声称的钞票 (s, $\rho$) 将包括将 $\rho$ 投影到
由 $|\psi_{s}\rangle$ 张成的子空间上。

现在，量子预言机 U 只是一个关于由有效钞票
张成的子空间的反射：也就是说，

$U=I-2\sum_{s\in\{0,1\}^{n}}|s\rangle\langle s|\otimes|\psi_{s}\rangle\langle\psi_{s}|$ 。

有了这个 U，验证钞票就变得微不足道了：我们只需将验证工作委托给预言机。
（技术上讲，U 还包括一个隐藏的组件，只有知道银行
秘密密钥 k 的人才能访问，它将 $|s\rangle|0\cdot\cdot\cdot0\rangle$ 映射到 $|s\rangle|\psi_{s}\rangle$，银行用它来印制新钞票。）

我们如何证明这个方案是安全的？一方面，根据不可克隆
定理，一个只拥有 $(s,|\psi_{s}\rangle)$ 并且无法访问 $U$ 的伪造者

83

--- 第 15 页 ---

将无法印制额外的钞票。另一方面，如果一个伪造者只能访问 $U$，
并且没有任何合法的钞票，不难看出，伪造者可以使用 $O(2^{n/2})$ 次对 U 的查询
来产生一张有效的钞票 $(s,|\psi_{s}\rangle)$——但是，另一方面，
根据 Grover 算法的最优性（见第 5 讲），$\Omega(2^{n/2})$ 次查询
也是必要的。

有趣的部分是表明，即使伪造者从一张有效的钞票
$(s,|\psi_{s}\rangle)$ 开始，伪造者仍然需要 $\Omega(2^{n/2})$ 次对 U 的查询才能产生第二张有效的钞票——
即，产生与 $|\psi_{s}\rangle\otimes|\psi_{s}\rangle$ 有不可忽略重叠的任何状态。这是 Aaronson
[Aar09] 称为复杂度理论不可克隆定理(Complexity-Theoretic No-Cloning Theorem) 的一个结果
（因为它将不可克隆定理与查询复杂度结合了起来）：

• 给定一个哈尔随机的 n 量子比特纯态 $|\psi\rangle$，以及一个
关于 $|\psi\rangle$ 反射的量子预言机 $U_{\psi}=I-2|\psi\rangle\langle\psi|$
，仍然需要 $\Omega(2^{n/2})$ 次对 $U_{\psi}$ 的查询才能产生与 $|\psi\rangle\otimes|\psi\rangle$ 具有
$\Omega(1)$ 保真度的任何状态。

我们不会在这里证明复杂度理论不可克隆定理，而只是勾勒
其主要思想。考虑所有 n 量子比特纯态对 $|\psi\rangle, |\phi\rangle$ 使得（比方说） $|\langle\psi|\phi\rangle|=1/2$。
人们会注意到，一个成功的克隆过程会将这些对映射到 $|\psi\rangle^{\otimes2}, |\phi\rangle^{\otimes2}$，它们满足

$|\langle\psi|^{\otimes2}|\phi\rangle^{\otimes2}|=|\langle\psi|\phi\rangle|^{2}=\frac{1}{4}.$

换句话说，对于所有这些对，该过程需要将内积减少
$1/4=\Omega(1)$。给定任何特定的对 $|\psi\rangle, |\phi\rangle$，不难设计一个对预言机
$U_{\psi}, U_{\phi}$ 的单次查询，分别将内积减少 $\Omega(1)$。然而，通过使用 Ambainis 的
敌手方法 [Amb02]，可以证明，如果
对是哈尔随机选择的（满足 $|\langle\psi|\phi\rangle|=1/2$），那么没有查询可以对大多数 $|\psi\rangle, |\phi\rangle$ 对
做到这一点。相反，任何查询最多只能将期望的平方保真度，

$\mathbb{E}_{|\psi\rangle,|\phi\rangle}[|\langle\psi|\phi\rangle|^{2}]$，

减少 $O(2^{-n/2})$，其中期望是针对所有这样的对。这继而意味着，要
为所有或甚至大多数对将平方保真度减少 $\Omega(1)$，我们需要对
U 进行 $\Omega(2^{n/2})$ 次查询——也就是说，查询次数与我们纯粹用 Grover 搜索 $|\psi\rangle$ 时一样多，
而不是从 $|\psi\rangle$ 的一个副本开始，然后仅仅需要制造第二个副本。

9.4 隐藏子空间方案

$\Pi$

因为定理 9.3.1 将所有工作都委托给了预言机 U，所以它对于我们如何在
“真实”、非相对化的世界中构建安全的公钥迷你方案几乎没有提供任何洞见。
作为朝着这个目标迈进的下一步，人们自然会想知道，是否可以证明公钥量子货币
相对于经典预言机 A（即，一个在量子叠加中访问的布尔函数）是可能的。
这个问题在 2012 年由 Aaronson 和 Christiano [AC12] 的工作回答了。

定理 9.4.1 (Aaronson-Christiano 2012 [AC12])。存在一个经典预言机，相对于
它，公钥量子货币是可能的。

证明概要。该构造基于“隐藏子空间”。特别地，令 $S\le\mathbb{F}_{2}^{n}$ 是
向量空间 $\mathbb{F}_{2}^{n}$ 的一个子空间，它是从满足 $dim(S)=n/2$ 的
所有子空间中均匀随机选择的。

84

--- 第 16 页 ---

（因此，S 恰好有 $2^{n/2}$ 个元素。）令

$S^{\perp}=\{x|x\cdot s\equiv0(mod~2)\forall s\in S\}$

是 S 的对偶子空间，它也满足 $dim(S^{\perp})=n/2$ 且 $|S^{\perp}|=2^{n/2}$。

那么，在我们的公钥迷你方案中，每张钞票将具有 $(d_{S},|S\rangle)$ 的形式，其中

• $d_{S}$ 是子空间 S 及其对偶子空间的一个混淆的经典描述（我们
将其作为序列号），并且

• $|S\rangle=\frac{1}{\sqrt{|S|}}\sum_{x\in S}|x\rangle$ 是 S 上的一个均匀叠加。

当我们将序列号 $d_{S}$ 作为“密码”提供给它时，经典预言机 A 让我们能够访问
S 和 $S^{\perp}$ 各自的特征函数 $\chi_{S}$ 和 $\chi_{S^{\perp}}$。使用这些，我们可以轻松地实现一个
到 $|S\rangle$ 上的投影。为此，我们只需对我们的货币状态（假定是
$|S\rangle$）执行以下操作：

• 应用 $\chi_{S}$，检查状态是否只在 S 元素上有支持。

• 对所有 n 个量子比特进行 Hadamard 变换，将 $|S\rangle$ 映射到 $|S^{\perp}\rangle$。

• 应用 $\chi_{S^{\perp}}$，检查变换后的状态是否只在 $S^{\perp}$ 元素上有支持。

• 再次对所有 n 个量子比特进行 Hadamard 变换，将状态恢复到 $|S\rangle$。

作为一个技术要点，预言机还包含一个单向映射 $(s_{1},...,s_{n/2})\rightarrow d_{S}$，这使得
银行能为它准备的给定钞票 $|S\rangle$ 找到混淆的序列号 $d_{S}$（给定 S 的一组基），
但不让用户在给定 $d_{S}$ 的情况下学到 S 的一组基，因为那将使其能够伪造。

关键的断言是：任何攻破这个迷你方案的算法——即，将 $|d_{S}\rangle|S\rangle$ 映射到
$|d_{S}\rangle|S\rangle^{\otimes2}$ 的算法——必须对预言机 $\chi_{S}$ 和 $\chi_{S^{\perp}}$ 进行 $\Omega(2^{n/4})$ 次查询。

这个断言（我们省略了其证明）是定理 9.3.1 证明中复杂度理论
不可克隆定理的一个稍强版本。说它更强，是因为在
其准备 $|S\rangle^{\otimes2}$ 的探索中，伪造算法现在不仅可以访问 $|S\rangle$ 的一个副本和
一个实现 $I-2|S\rangle\langle S|$ 的酉变换，还可以访问预言机 $\chi_{S}$ 和 $\chi_{S^{\perp}}$。然而，
再次使用 Ambainis 的量子敌手方法，可以证明没有比
简单地对 $\chi_{S}$ 或 $\chi_{S^{\perp}}$ 进行 Grover 搜索以寻找 S 或 $S^{\perp}$ 的一组基
更快的制备 $|S\rangle$ 新副本的方法了——即，与人们“从头开始”准备 $|S\rangle$，
完全没有 $|S\rangle$ 副本时所使用的方法相同。而我们知道，Grover 搜索 S 或
$S^{\perp}$ 中的一个非零元素分别需要 $\Omega(2^{n/4})$ 次对 $\chi_{S}$ 或 $\chi_{S^{\perp}}$ 的查询。

完成安全性证明还需要另外两个想法。首先，基于
复杂度理论不可克隆定理的论证意味着需要 $\Omega(2^{n/4})$ 次预言机查询
来准备一个与 $|S\rangle^{\otimes2}$ 具有非常高保真度的状态。但是，准备一个
仅仅与 $|S\rangle^{\otimes2}$ 具有不可忽略（$1/poly$）保真度的状态呢——这当然已经足以
根据我们的安全定义攻破迷你方案了？为了排除这种情况，Aaronson 和
Christiano 给出了一种方法，在任何验证由
投影到一个 1 维子空间组成的货币方案中，将弱伪造者“放大”为
强伪造者，而查询复杂度只有多项式开销。

85

--- 第 17 页 ---

测量到一个 1 维子空间。这反过来又依赖于
振幅放大的近期变体，它们单调地收敛到目标状态（在这种情况下是 $|S\rangle^{\otimes2}$），
而不是在进行过多查询时“过冲”（参见，例如，Tulsi、Grover 和 Patel [TGP06]）。

第二个问题是，复杂度理论不可克隆定理只排除了
一个将 $|S\rangle$ 映射到 $|S\rangle^{\otimes2}$ 的伪造者（对于所有 $dim(S)=n/2$ 的子空间 S，或者至少是
绝大多数）。但是，再次地，一个只在 $1/poly$ 比例的
子空间上成功的伪造者呢？为了处理这个问题，Aaronson 和 Christiano 表明，
隐藏子空间方案具有“随机自归约” (random self-reducibility) 特性：任何
在一个不可忽略比例的 S 上奏效的伪造者 C 都可以被转换为一个
在任何 S 上都奏效的伪造者。这是通过给出一个
显式的随机自归约来证明的：从一个状态 $|S\rangle$ 开始，可以应用一个线性变换
将 $|S\rangle$ 映射到某个随机的其他子空间状态 $|T\rangle$，同时还将预言机 $\chi_{S}$ 或
$\chi_{S^{\perp}}$ 替换为“模拟预言机” $\chi_{T}$ 或 $\chi_{T^{\perp}}$，它们使用 $\chi_{S}$ 和 $\chi_{S^{\perp}}$ 来分别识别 T 和 $T^{\perp}$
的元素。
$\Pi$

现在，一旦我们有了一个相对于经典
预言机安全的公钥量子货币方案，Aaronson 和 Christiano [AC12] 观察到，我们
基本上可以免费得到别的东西：
即一个私钥量子货币方案，其中钞票在验证后被退回，但
仍然能抵抗交互式攻击。这解决了第 8 讲留下的主要问题之一。
让我们现在来解释一下这种联系。

定理 9.4.2 (Aaronson-Christiano 2012 [AC12])。存在一个能抵抗交互式攻击的
私钥量子货币方案（不需要计算假设，尽管
银行需要维护一个巨大的数据库）。

证明。每张钞票的形式为 $|z\rangle|S_{z}\rangle$，其中 $|z\rangle$ 是一个经典序列号，而 $|S_{z}\rangle$ 是
$\mathbb{F}_{2}^{n}$ 的一个维度为 $n/2$ 的子空间 $S_{z}$ 上的均匀叠加。银行在一个巨大的数据库中，
存储流通中每张钞票的序列号 z，以及 $S_{z}$ 的一组基。当用户
提交 $|z\rangle|S_{z}\rangle$ 给银行进行验证时，银行可以利用其对 $S_{z}$ 一组基的了解来
判定 $S_{z}$ 和 $S_{z}^{\perp}$ 中的成员，从而实现一个到 $|S_{z}\rangle$ 上的投影。另一
方面，假设有可能使用 poly(n) 次对银行的查询（
提交的钞票在成功甚至失败的验证时都返回给用户），将 $|z\rangle|S_{z}\rangle$ 映射到 $|z\rangle|S_{z}\rangle^{\otimes2}$。
那么通过使用预言机 A 来模拟对银行的查询，我们也可以在
定理 9.4.1 的方案中将 $|d_{S}\rangle|S\rangle$ 映射到 $|d_{S}\rangle|S\rangle^{\otimes2}$，从而攻破该方案。
但这将与定理 9.4.1 相矛盾。
因此，将 $|z\rangle|S_{z}\rangle$ 映射到 $|z\rangle|S_{z}\rangle^{\otimes2}$ 需要 $\Omega(2^{n/2})$ 次对银行的查询。

9.5 实例化

$\Pi$

鉴于定理 9.4.1，一个显而易见的问题是，是否有可能“实例化”
隐藏子空间构造，从而摆脱预言机 A。这将需要提供
子空间 S 和 $S^{\perp}$ 的“混淆”描述——一种让用户能高效应用 $\chi_{S}$ 和 $\chi_{S^{\perp}}$
来验证钞票，但又不会泄露 S 的一组基的描述。

在他们的论文中，Aaronson 和 Christiano [AC12] 为此提供了一个建议，
基于低阶多项式。更具体地说：假设一张钞票 $|S\rangle$ 的序列号编码了
两组（比方说）3 次多项式，

$p_1, \dots, p_m : \mathbb{F}_2^n \rightarrow \mathbb{F}_2 \text{ 和 } q_1, \dots, q_m : \mathbb{F}_2^n \rightarrow \mathbb{F}_2$,

86

--- 第 18 页 ---

对于某个 $m=O(n)$，使得 $p_{1},...,p_{m}$ 同时在 S 上（且仅在 S 上）为零，而
$q_{1},...,q_{m}$ 同时在 $S^{\perp}$ 上（且仅在 $S^{\perp}$ 上）为零。给定 S，很容易高效地生成
这样的多项式——例如，通过选择在某个
规范子空间 $S_{0}$（比方说，由前 $n/2$ 个基向量张成的子空间）上为零的随机 3 次多项式，
然后用一个将 $S_{0}$ 映射到 S 的线性变换作用于这些多项式。为了增加安全性，我们还可以
添加噪声：$\epsilon$ 比例的多项式可以被完全随机地选择。

显然，给定这些多项式，我们可以用它们来计算特征函数 $\chi_{S}$
和 $\chi_{S^{\perp}}$，而不需要预言机。但是，仅给定这些多项式，至少没有明显的方法来
恢复 S 的一组基，所以人们可能希望复制 $|S\rangle$ 也是棘手的。

为了为此提供证据，Aaronson 和 Christiano [AC12] 给出了以下安全归约。

定理 9.5.1 ([AC12])。假设隐藏子空间迷你方案可以被攻破，
其中函数 $\chi_{S}$ 和 $\chi_{S^{\perp}}$ 是由 3 次多项式集合 $p_{1},...,p_{m}:\mathbb{F}_{2}^{n}\rightarrow\mathbb{F}_{2}$ 和
$q_{1},...,q_{m}:\mathbb{F}_{2}^{n}\rightarrow\mathbb{F}_{2}$ 分别实现的。那么存在一个多项式时间的量子算法，
在给定 $p_{i}$ 和 $q_{i}$ 的情况下，以 $\Omega(2^{-n/2})$ 的成功概率找到 S 的一组基。

证明。论证出奇地简单。假设存在如假设所述的伪造算法 C，
它使用 $p_{1},...,p_{m}$ 和 $q_{1},...,q_{m}$ 将 $|S\rangle$ 映射到 $|S\rangle^{\otimes2}$。那么考虑
以下算法，以 $\sim 2^{-n/2}$ 的成功概率找到 S 的一组基：

(1) 准备一个在所有 n 比特字符串上的均匀叠加。

(2) 在叠加的元素上计算 $p_{1},...,p_{m}$，并以得到全 0
结果为条件——从而以 $2^{-n/2}$ 的成功概率将叠加坍缩到 $|S\rangle$。

(3) 如果测量成功，则重复运行 C，将 $|S\rangle$ 映射到 $|S\rangle^{\otimes m}$，其中 $m=\Theta(n)$。
(4) 在计算基础上测量 $|S\rangle$ 的每个副本，以学到 S 的一组基。

一个以指数级小的成功概率 $\Omega(2^{-n/2})$ 找到 S 的一组基的算法
听起来可能不那么令人印象深刻或不太可能。然而，请注意，如果一个人试图通过
随机猜测来找到 S 的一组基，他成功的概率只有 $2^{-\Omega(n^{2})}$。

9.6 攻击

不幸的是，最近的一些进展已经大大改变了这幅图景。

首先，在 2014 年，Pena 等人 [PFP15] 证明，如果
该方案不是定义在 $\mathbb{F}_{2}$ 上，而是定义在奇特征的有限域上，那么低阶多项式
方案的无噪声版本可以被攻破。
他们的证明使用了 Gröbner 基方法，它实际上得出了比
攻破货币方案更强的结果：即，一个多项式时间的经典算法，
在给定 $p_{1},...,p_{m}$（对偶多项式 $q_{1},...,q_{m}$ 甚至都不需要）的情况下恢复 S 的一组基。在 $\mathbb{F}_{2}$ 的情况下，Pena 等人
基于数值证据推测，他们的 Gröbner 基技术至少会
产生一个准多项式时间的算法。

无论如何，低阶多项式方案的含噪声版本并没有受到这些
结果的影响，因为 Gröbner 基技术在存在噪声的情况下会失效。

87

--- 第 19 页 ---

然而，在最近一个戏剧性的进展中，Christiano 和其他人已经完全攻破了含噪声的
低阶多项式方案。他们通过给出一个量子归约，将
攻破含噪声方案的问题归约到攻破无噪声方案的问题，而 Pena 等人
已经解决了后者。（因此，与 Pena 等人的结果不同，这部分攻击是
特定于量子货币的。）

回想起来，这个归约非常简单。给定多项式 $p_{1},...,p_{m}$ 和 $q_{1},...,q_{m}$，
并给定一个货币状态 $|S\rangle$，我们的目标是使用对 $|S\rangle$ 的测量来决定哪些 $p_{i}$ 和 $q_{i}$
是“真的”（即，在 S 上的任何地方都为零），哪些是“含噪声的”（即，仅在 S 中
约 $1/2$ 的点上为零）。

给定一个多项式（比方说）$p_{j}$，我们当然可以在 $|S\rangle$ 上评估 $p_{j}$ 然后测量结果。如果
$p_{j}$ 是真的，那么我们将确定地观察到结果 0，而如果 $p_{j}$ 是含噪声的，我们将以
大致相等的概率观察到结果 0 和 1。这种方法的问题在于，如果 $p_{j}$ 是
含噪声的，那么测量将破坏状态 $|S\rangle$，使其对将来的测量毫无用处。

然而，在这里，我们可以使用 Farhi 等人
$[\text{FGH}^{+}10]$ 在 2010 年攻破其他公钥量子货币方案的背景下
引入的单拷贝层析成像 (single-copy tomography) 的非凡思想。
这个想法是这样的：在我们进行一次测量，将 $|S\rangle$ 损坏为某个其他状态 $|\psi\rangle$ 之后，我们
然后使用振幅放大（见第 5 讲）将 $|\psi\rangle$ 恢复到 $|S\rangle$。现在，振幅放大
需要能够围绕初始状态 $|\psi\rangle$ 和目标状态 $|S\rangle$ 进行反射。但是我们
可以使用多项式 $p_{1},...,p_{m}$ 和 $q_{1},...,q_{m}$ 来做到这一点！特别是，要围绕 $|S\rangle$ 反射，
我们当且仅当一个足够比例的 $p_{i}$ 和 $q_{i}$ 评估为 0 时，才对每个基态的振幅取反，
而要围绕 $|\psi\rangle$ 反射，我们当且仅当一个足够比例的
$p_{i}$ 和 $q_{i}$ 评估为 0，并且我们刚刚测量的多项式 $p_{j}$ 评估为
我们观察到的任何测量结果（0 或 1）时，才对每个基态的振幅取反。这种方法让我们能够
逐一检查 $p_{i}$ 和 $q_{i}$，识别哪些是含噪声的，而不会对状态 $|S\rangle$ 造成永久性损害。

取定理 9.5.1 的逆否命题，新攻击的一个显著推论是，
给定一组含噪声的低阶多项式 $p_{1},...,p_{m}$ 和 $q_{1},...,q_{m}$，存在一个多项式时间的
量子算法，能以 $\Omega(2^{-n/2})$ 的成功概率恢复 S 的一组基。

再次说明，一个朴素的算法只能以 $2^{-\Omega(n^{2})}$ 的概率成功（通过一些小聪明，
人们可以将其提高到 $2^{-cn}$，对于某个大常数 c）。我们不知道
这个问题的任何能以 $\Omega(1)$ 概率成功的量子算法，也不知道
任何能以 $\Omega(2^{-n/2})$ 概率成功的经典算法。因此，从这次攻击中产生的算法似乎是
一个真正新颖的量子算法，它专门适用于极小成功
概率的机制。最令人惊讶的部分是，这个算法来自对一个量子
货币方案的攻击；否则我们不知道如何去启发它。

9.7 未来方向

然而，回到量子货币，规避这种对
低阶多项式方案的攻击的前景如何？所需要的只是一些新的、更安全的方法来实例化
Aaronson 和 Christiano 的隐藏子空间方案中的
黑盒函数 $\chi_{S}$ 和 $\chi_{S^{\perp}}$。作为一种
权宜之计，人们可以使用密码学中最近的一个称为
不可区分混淆 (indistinguishability obfuscation, i.o.) 的思想来实例化 $\chi_{S}$ 和 $\chi_{S^{\perp}}$。I.o. 有一个
奇特的特性，即当我们用它来混淆一个给定的函数 f 时，我们通常可以证明，如果存在
任何安全的方式来混淆 $f$，并且 i.o. 本身也是安全的，那么 i.o. 会产生一个 f 的安全混淆实现。在
这种情况下，结果将是，如果子空间 S 和 $S^{\perp}$ 的特征函数

88

--- 第 20 页 ---

可以被混淆，那么 i.o. 是混淆它们的一种方法！讽刺的是，这为我们
使用 i.o. 提供了强有力的论据，尽管几乎没有证据表明任何安全的实现是可能的。

其他的想法包括使用基于格 (lattice-based) 的
密码学来实现 $\chi_{S}$ 和 $\chi_{S^{\perp}}$ 或类似的东西，或者回到量子货币的其他想法，
例如 Farhi 等人 $[\text{FGH}^{+}12]$ 的基于纽结的方案，并试图给它们更严格的
基础。与此同时，关于公钥量子货币，还有
许多其他美妙的开放问题。这里有一个我个人特别喜欢的：
公钥量子货币是否可能相对于一个随机预言机？

除了量子货币，另一个迷人的挑战是受版权保护的量子软件 (copy-protected quantum software)：
也就是说，量子态 $|\psi_{f}\rangle$ 将有助于评估一个布尔函数 f，但
不能用于准备也可用于评估 f 的额外状态。在即将发表的工作中，Aaronson 和
Christiano 表明，受版权保护的量子软件相对于一个经典
预言机是“通用”可能的。但是，为
通用函数 f 提供一个安全的“真实世界”的量子版权保护实现，或者哪怕只是一个
好的候选方案，仍有待完成。

89